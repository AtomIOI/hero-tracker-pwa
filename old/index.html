<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- PWA Configuration -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Hero Tracker">
    <meta name="theme-color" content="#ec008c">
    <meta name="description" content="Modular Hero Character Tracker with Vintage Comic Book Aesthetic">

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="/assets/icons/placeholder-icon.svg">
    <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">

    <title>Hero Tracker</title>

    <!-- Scripts -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Comic+Neue:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        /* CSS Variables */
        :root {
            --color-paper: #fdf6e3;
            --color-ink: #1a1a1a;
            --color-cyan: #00aeef;
            --color-magenta: #ec008c;
            --color-yellow: #fff200;
            --color-black: #231f20;
        }

        /* Global Styles */
        body {
            font-family: 'Comic Neue', cursive, sans-serif;
            background-color: var(--color-paper);
            background-image:
                radial-gradient(var(--color-ink) 1px, transparent 1px),
                radial-gradient(var(--color-ink) 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        /* Typography */
        .comic-title {
            font-family: 'Bangers', cursive;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: 3px 3px 0px var(--color-ink);
        }

        /* Layout Components */
        .comic-card {
            background-color: white;
            border: 4px solid var(--color-ink);
            box-shadow: 8px 8px 0px var(--color-black);
            position: relative;
        }

        .comic-card::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 2px solid var(--color-ink);
            pointer-events: none;
        }

        /* Interactive Elements */
        .comic-button {
            border: 3px solid var(--color-ink);
            box-shadow: 4px 4px 0px var(--color-black);
            font-family: 'Bangers', cursive;
            letter-spacing: 1px;
            transition: all 0.2s ease;
        }

        .comic-button:active {
            box-shadow: 2px 2px 0px var(--color-black);
            transform: translate(2px, 2px);
        }

        .comic-input {
            border: 3px solid var(--color-ink);
            padding: 0.5rem;
            font-family: 'Comic Neue', cursive;
            font-weight: bold;
            background-color: white;
        }

        .comic-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px var(--color-yellow);
        }

        /* Special Effects */
        .locked-ability {
            position: relative;
            opacity: 0.6;
            pointer-events: none;
            background: repeating-linear-gradient(45deg,
                    transparent,
                    transparent 10px,
                    rgba(0, 0, 0, 0.1) 10px,
                    rgba(0, 0, 0, 0.1) 20px);
        }

        .locked-ability::after {
            content: 'LOCKED!';
            font-family: 'Bangers', cursive;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 2.5rem;
            color: var(--color-magenta);
            text-shadow: 2px 2px 0px white, 4px 4px 0px var(--color-ink);
            border: 3px solid var(--color-ink);
            padding: 0.5rem 1rem;
            background: white;
            box-shadow: 4px 4px 0px var(--color-black);
            z-index: 10;
        }

        /* Theme Variants */
        .theme-green {
            background-color: #e0f2fe;
            background-image: radial-gradient(var(--color-cyan) 2px, transparent 2px);
            background-size: 15px 15px;
        }

        .theme-yellow {
            background-color: #fef3c7;
            background-image: radial-gradient(var(--color-yellow) 2px, transparent 2px);
            background-size: 15px 15px;
        }

        .theme-red {
            background-color: #fee2e2;
            background-image: radial-gradient(var(--color-magenta) 2px, transparent 2px);
            background-size: 15px 15px;
        }

        .theme-out {
            background-color: #f3f4f6;
            background-image: radial-gradient(var(--color-black) 2px, transparent 2px);
            background-size: 15px 15px;
            filter: grayscale(100%) contrast(1.2);
        }
    </style>
</head>

<body class="min-h-screen p-4" id="app">
    <div :class="getThemeClass()" class="min-h-screen transition-all duration-500">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="comic-card bg-white p-6 mb-6">
                <h1 class="comic-title text-6xl text-center mb-2" :class="getTextColorClass()">
                    ‚ö° HERO TRACKER ‚ö°
                </h1>
                <p class="text-center text-lg font-bold">Modular Hero Character Tracker</p>
            </div>

            <!-- Global Status Monitor (GYRO) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- Health Input -->
                <div class="comic-card bg-white p-6">
                    <h2 class="comic-title text-2xl mb-4">‚öïÔ∏è HEALTH</h2>
                    <div class="mb-4">
                        <label class="font-bold block mb-1">Current Health:</label>
                        <input type="number" v-model.number="character.currentHealth" @input="saveToLocalStorage"
                            class="comic-input w-full text-2xl" />
                    </div>
                    <div class="mb-4">
                        <label class="font-bold block mb-1">Max Health:</label>
                        <input type="number" v-model.number="character.maxHealth" @input="saveToLocalStorage"
                            class="comic-input w-full text-2xl" />
                    </div>
                </div>

                <!-- Zone Display -->
                <div class="comic-card bg-white p-6">
                    <h2 class="comic-title text-2xl mb-4">üìä ZONE STATUS</h2>
                    <div class="text-6xl font-bold text-center" :class="getTextColorClass()">
                        {{ getZone().toUpperCase() }}
                    </div>
                    <div class="text-2xl font-bold text-center mt-4">
                        {{ getHealthPercentage() }}%
                    </div>
                </div>

                <!-- Health Bar -->
                <div class="comic-card bg-white p-6">
                    <h2 class="comic-title text-2xl mb-4">üí™ LIFE FORCE</h2>
                    <div class="w-full bg-gray-300 h-12 border-4 border-black relative overflow-hidden">
                        <div :class="getHealthBarClass()" class="h-full transition-all duration-500"
                            :style="{width: getHealthPercentage() + '%'}"></div>
                        <span class="absolute inset-0 flex items-center justify-center font-bold text-2xl text-shadow">
                            {{ character.currentHealth }} / {{ character.maxHealth }}
                        </span>
                    </div>
                    <div class="mt-4">
                        <label class="flex items-center">
                            <input type="checkbox" v-model="character.sceneOverride" @change="saveToLocalStorage"
                                class="mr-2 w-6 h-6">
                            <span class="font-bold">‚ö†Ô∏è Red Zone Override</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Power Modules -->
            <div class="comic-card bg-white p-6 mb-6">
                <h2 class="comic-title text-3xl mb-4">‚ö° POWER MODULES</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                    <div v-for="(module, index) in character.modules" :key="index" class="comic-card p-4 relative"
                        :class="isModuleLocked(module) ? 'locked-ability' : 'bg-blue-100'">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-bold">{{ module.name }}</h3>
                            <button @click="removeModule(index)"
                                class="comic-button bg-red-500 text-white px-2 py-1 text-sm">‚úï</button>
                        </div>
                        <div class="mb-2"><strong>Die:</strong> {{ module.dieRating }}</div>
                        <div class="mb-2"><strong>Zone:</strong> <span class="uppercase font-bold">{{ module.zoneTag
                                }}</span></div>
                        <div class="text-sm">{{ module.text }}</div>
                    </div>
                </div>

                <button @click="addModule" class="comic-button bg-green-500 text-white px-6 py-3 text-xl w-full">
                    ‚ûï ADD NEW POWER
                </button>
            </div>

            <!-- Dice Tray -->
            <div class="comic-card bg-white p-6 mb-6">
                <h2 class="comic-title text-3xl mb-4">üé≤ DICE TRAY</h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="font-bold block mb-1">Power Die:</label>
                        <select v-model="diceEngine.powerDie" class="comic-input w-full">
                            <option value="d4">d4</option>
                            <option value="d6">d6</option>
                            <option value="d8">d8</option>
                            <option value="d10">d10</option>
                            <option value="d12">d12</option>
                        </select>
                    </div>
                    <div>
                        <label class="font-bold block mb-1">Quality Die:</label>
                        <select v-model="diceEngine.qualityDie" class="comic-input w-full">
                            <option value="d4">d4</option>
                            <option value="d6">d6</option>
                            <option value="d8">d8</option>
                            <option value="d10">d10</option>
                            <option value="d12">d12</option>
                        </select>
                    </div>
                    <div>
                        <label class="font-bold block mb-1">Status Die (suggested: {{ getSuggestedStatusDie()
                            }}):</label>
                        <select v-model="diceEngine.statusDie" class="comic-input w-full">
                            <option value="d4">d4</option>
                            <option value="d6">d6</option>
                            <option value="d8">d8</option>
                            <option value="d10">d10</option>
                            <option value="d12">d12</option>
                        </select>
                    </div>
                </div>

                <button @click="rollDice" class="comic-button bg-purple-500 text-white px-8 py-4 text-2xl w-full mb-4">
                    üé≤ ROLL DICE!
                </button>

                <!-- Results -->
                <div v-if="diceEngine.results" class="grid grid-cols-3 gap-4">
                    <div class="comic-card bg-red-200 p-6 text-center">
                        <div class="text-sm font-bold mb-2">MIN</div>
                        <div class="text-5xl font-bold">{{ diceEngine.results.min }}</div>
                    </div>
                    <div class="comic-card bg-yellow-200 p-6 text-center transform scale-110 border-8">
                        <div class="text-sm font-bold mb-2">MID (EFFECT) ‚≠ê</div>
                        <div class="text-6xl font-bold">{{ diceEngine.results.mid }}</div>
                    </div>
                    <div class="comic-card bg-green-200 p-6 text-center">
                        <div class="text-sm font-bold mb-2">MAX</div>
                        <div class="text-5xl font-bold">{{ diceEngine.results.max }}</div>
                    </div>
                </div>
            </div>

            <!-- Hero Principles & Tracking -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- Principles -->
                <div class="comic-card bg-white p-6">
                    <h2 class="comic-title text-3xl mb-4">üìú HERO PRINCIPLES</h2>
                    <textarea v-model="character.principles" @input="saveToLocalStorage"
                        placeholder="Enter your hero's core principles and roleplay triggers..."
                        class="comic-input w-full resize-none" rows="8"></textarea>
                </div>

                <!-- Hero Points -->
                <div class="comic-card bg-white p-6">
                    <h2 class="comic-title text-3xl mb-4">‚≠ê HERO TRACKING</h2>

                    <div class="mb-6">
                        <label class="font-bold block mb-2 text-xl">Hero Points:</label>
                        <div class="flex items-center gap-4">
                            <button @click="character.heroPoints--; saveToLocalStorage()"
                                class="comic-button bg-red-500 text-white px-6 py-3 text-2xl">
                                ‚ûñ
                            </button>
                            <div class="text-6xl font-bold flex-1 text-center border-4 border-black p-4 bg-yellow-100">
                                {{ character.heroPoints }}
                            </div>
                            <button @click="character.heroPoints++; saveToLocalStorage()"
                                class="comic-button bg-green-500 text-white px-6 py-3 text-2xl">
                                ‚ûï
                            </button>
                        </div>
                    </div>

                    <div>
                        <label class="font-bold block mb-2 text-xl">Bonuses/Penalties:</label>
                        <div class="flex items-center gap-4">
                            <button @click="character.modifiers--; saveToLocalStorage()"
                                class="comic-button bg-red-500 text-white px-6 py-3 text-2xl">
                                ‚ûñ
                            </button>
                            <div class="text-6xl font-bold flex-1 text-center border-4 border-black p-4 bg-blue-100">
                                {{ character.modifiers >= 0 ? '+' : '' }}{{ character.modifiers }}
                            </div>
                            <button @click="character.modifiers++; saveToLocalStorage()"
                                class="comic-button bg-green-500 text-white px-6 py-3 text-2xl">
                                ‚ûï
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export/Import -->
            <div class="comic-card bg-white p-6 mb-6">
                <h2 class="comic-title text-3xl mb-4">üíæ SAVE & LOAD</h2>
                <div class="flex gap-4">
                    <button @click="exportJSON" class="comic-button bg-green-500 text-white px-8 py-4 text-xl flex-1">
                        üíæ EXPORT JSON
                    </button>
                    <label
                        class="comic-button bg-blue-500 text-white px-8 py-4 text-xl flex-1 cursor-pointer text-center">
                        üìÇ IMPORT JSON
                        <input type="file" @change="importJSON" accept="application/json" class="hidden">
                    </label>
                </div>
            </div>
        </div>

        <!-- Add Module Modal -->
        <div v-if="showAddModuleModal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="comic-card bg-white p-6 max-w-md w-full mx-4">
                <h3 class="comic-title text-3xl mb-4">‚ö° NEW POWER MODULE</h3>

                <div class="mb-4">
                    <label class="font-bold block mb-1">Power Name:</label>
                    <input v-model="newModule.name" class="comic-input w-full" placeholder="e.g. Laser Eyes">
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="font-bold block mb-1">Die Rating:</label>
                        <select v-model="newModule.dieRating" class="comic-input w-full">
                            <option value="d6">d6</option>
                            <option value="d8">d8</option>
                            <option value="d10">d10</option>
                            <option value="d12">d12</option>
                        </select>
                    </div>
                    <div>
                        <label class="font-bold block mb-1">Zone Tag:</label>
                        <select v-model="newModule.zoneTag" class="comic-input w-full">
                            <option value="green">Green</option>
                            <option value="yellow">Yellow</option>
                            <option value="red">Red</option>
                        </select>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="font-bold block mb-1">Description:</label>
                    <textarea v-model="newModule.text" class="comic-input w-full resize-none" rows="3"
                        placeholder="What does it do?"></textarea>
                </div>

                <div class="flex justify-end gap-4">
                    <button @click="showAddModuleModal = false"
                        class="comic-button bg-gray-400 text-white px-4 py-2">CANCEL</button>
                    <button @click="confirmAddModule" class="comic-button bg-blue-500 text-white px-6 py-2">CONFIRM
                        ADD</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    showAddModuleModal: false,
                    newModule: {
                        name: '',
                        dieRating: 'd8',
                        text: '',
                        zoneTag: 'green'
                    },
                    character: {
                        currentHealth: 100,
                        maxHealth: 100,
                        sceneOverride: false,
                        modules: [],
                        principles: '',
                        heroPoints: 0,
                        modifiers: 0
                    },
                    diceEngine: {
                        powerDie: 'd8',
                        qualityDie: 'd8',
                        statusDie: 'd8',
                        results: null
                    }
                };
            },
            mounted() {
                this.loadFromLocalStorage();
            },
            methods: {
                getHealthPercentage() {
                    if (this.character.maxHealth === 0) return 0;
                    return Math.round((this.character.currentHealth / this.character.maxHealth) * 100);
                },
                getZone() {
                    if (this.character.sceneOverride) return 'red';
                    if (this.character.currentHealth <= 0) return 'out';

                    const percentage = this.getHealthPercentage();
                    if (percentage >= 75) return 'green';
                    if (percentage >= 35) return 'yellow';
                    if (percentage >= 1) return 'red';
                    return 'out';
                },
                getThemeClass() {
                    const zone = this.getZone();
                    return `theme-${zone}`;
                },
                getTextColorClass() {
                    const zone = this.getZone();
                    const colors = {
                        green: 'text-green-600',
                        yellow: 'text-yellow-600',
                        red: 'text-red-600',
                        out: 'text-gray-600'
                    };
                    return colors[zone];
                },
                getHealthBarClass() {
                    const zone = this.getZone();
                    const colors = {
                        green: 'bg-green-500',
                        yellow: 'bg-yellow-500',
                        red: 'bg-red-500',
                        out: 'bg-gray-500'
                    };
                    return colors[zone];
                },
                toggleOverride() {
                    this.character.sceneOverride = !this.character.sceneOverride;
                    this.saveToLocalStorage();
                },
                addModule() {
                    this.newModule = {
                        name: '',
                        dieRating: 'd8',
                        text: '',
                        zoneTag: 'green'
                    };
                    this.showAddModuleModal = true;
                },
                confirmAddModule() {
                    if (!this.newModule.name) this.newModule.name = 'New Power';

                    this.character.modules.push({ ...this.newModule });
                    this.saveToLocalStorage();
                    this.showAddModuleModal = false;
                },
                removeModule(index) {
                    this.character.modules.splice(index, 1);
                    this.saveToLocalStorage();
                },
                isModuleLocked(module) {
                    const currentZone = this.getZone();

                    // Green Zone: Lock Yellow and Red
                    if (currentZone === 'green' && (module.zoneTag === 'yellow' || module.zoneTag === 'red')) {
                        return true;
                    }

                    // Yellow Zone: Lock Red
                    if (currentZone === 'yellow' && module.zoneTag === 'red') {
                        return true;
                    }

                    return false;
                },
                getSuggestedStatusDie() {
                    const zone = this.getZone();
                    const suggestions = {
                        green: 'd10',
                        yellow: 'd8',
                        red: 'd6',
                        out: 'd4'
                    };
                    return suggestions[zone];
                },
                rollDie(dieType) {
                    const max = parseInt(dieType.substring(1));
                    return Math.floor(Math.random() * max) + 1;
                },
                rollDice() {
                    const results = [
                        this.rollDie(this.diceEngine.powerDie),
                        this.rollDie(this.diceEngine.qualityDie),
                        this.rollDie(this.diceEngine.statusDie)
                    ];

                    results.sort((a, b) => a - b);

                    this.diceEngine.results = {
                        min: results[0],
                        mid: results[1],
                        max: results[2]
                    };
                },
                saveToLocalStorage() {
                    const saveData = {
                        character: this.character,
                        diceEngine: {
                            powerDie: this.diceEngine.powerDie,
                            qualityDie: this.diceEngine.qualityDie,
                            statusDie: this.diceEngine.statusDie
                        }
                    };
                    localStorage.setItem('hero-character', JSON.stringify(saveData));
                },
                loadFromLocalStorage() {
                    const saved = localStorage.getItem('hero-character');
                    if (saved) {
                        try {
                            const data = JSON.parse(saved);
                            this.character = data.character;
                            if (data.diceEngine) {
                                this.diceEngine.powerDie = data.diceEngine.powerDie;
                                this.diceEngine.qualityDie = data.diceEngine.qualityDie;
                                this.diceEngine.statusDie = data.diceEngine.statusDie;
                            }
                        } catch (e) {
                            console.error('Error loading from localStorage:', e);
                        }
                    }
                },
                exportJSON() {
                    const data = {
                        character: this.character,
                        exportDate: new Date().toISOString(),
                        version: '1.0'
                    };

                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `hero-character-${Date.now()}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                },
                importJSON(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.character) {
                                this.character = data.character;
                                this.saveToLocalStorage();
                                alert('Character loaded successfully!');
                            } else {
                                alert('Invalid character file format.');
                            }
                        } catch (error) {
                            alert('Error reading file: ' + error.message);
                        }
                    };
                    reader.readAsText(file);

                    // Reset the input
                    event.target.value = '';
                }
            }
        }).mount('#app');
    </script>
</body>

</html>